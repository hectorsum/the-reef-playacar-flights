!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function t(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function n(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}Object.create;function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e){return this instanceof o?(this.v=e,this):new o(e)}function s(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){s.push([e,t,n,r])>1||c(e,t)}))})}function c(e,t){try{(n=i[e](t)).value instanceof o?Promise.resolve(n.value.v).then(l,d):u(s[0][2],n)}catch(e){u(s[0][3],e)}var n}function l(e){c("next",e)}function d(e){c("throw",e)}function u(e,t){e(t),s.shift(),s.length&&c(s[0][0],s[0][1])}}function a(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:o(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=i(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}Object.create;class l{constructor(e){const t=l.RFC_3986.exec(e);if(!t)throw new Error("Invalid Uri: "+e);const[,,n,,r,i,,o,,s]=t;this.scheme=n,this.authority=r?new d(r):void 0,this.path=i,this.query=o,this.fragment=s}toString(){const e=[];return void 0!==this.scheme&&e.push(this.scheme,":"),void 0!==this.authority&&e.push("//",this.authority.toString()),e.push(this.path),void 0!==this.query&&e.push("?",this.query),void 0!==this.fragment&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}}l.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class d{constructor(e){const t=d.RFC_3986.exec(e);if(!t)throw new Error("Invalid Authority: "+e);const[,n,r,i]=t;this.userInfo=n,this.host=r,this.port=i}toString(){const e=[];return void 0!==this.userInfo&&e.push(this.userInfo,"@"),void 0!==this.host&&e.push(this.host),void 0!==this.port&&e.push(":",this.port),e.join("")}}d.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var u={};Object.defineProperty(u,"__esModule",{value:!0});var h=(ue=void 0,ge=u.IdentityTransducer=ue,pe=u.identity=ge,ye=u.transducer=pe,ve=u.FirstTransducer=ye,we=u.first=ve,Ee=u.LastTransducer=we,xe=u.last=Ee,Se=u.MapTransducer=xe,Ae=u.map=Se,Te=u.ZipTransducer=Ae,Ce=u.zip=Te,Pe=u.zipWithIndex=Ce,Le=u.FlatMapTransducer=Pe,Me=u.flatMap=Le,Be=u.FilterTransducer=Me,He=u.filter=Be,_e=u.reject=He,Ne=u.find=_e,Fe=u.CompositeTransducer=Ne,We=u.compose=Fe,Ue=u.decompose=We,Ge=u.ScanTransducer=Ue,Ke=u.scan=Ge,Ze=u.reduce=Ke,Xe=u.TakeTransducer=Ze,Qe=u.take=Xe,et=u.DropTransducer=Qe,nt=u.drop=et,rt=u.DropWhileTransducer=nt,ot=u.dropWhile=rt,st=u.TakeWhileTransducer=ot,ct=u.takeWhile=st,lt=u.SortTransducer=ct,ut=u.sort=lt,ht=u.DedupTransducer=ut,pt=u.dedupe=ht,ft=u.UniqueTransducer=pt,yt=u.unique=ft,u.windowed=yt);u.WindowedTransducer=h;var g={};Object.defineProperty(g,"__esModule",{value:!0});var p=(L=void 0,q=g.ascending=L,M=g.descending=q,R=g.comparators=M,B=g.key=R,_=g.value=B,z=g.isIterable=_,N=g.isAsyncIterable=z,D=g.isPromiseLike=N,F=g.toIterable=D,$=g.iterable=F,U=g.isArrayLike=$,V=g.array=U,G=g.toAsyncIterable=V,g.by=G);g.single=p;var f={};Object.defineProperty(f,"__esModule",{value:!0});var y=(O=void 0,x=f.iterate=O,S=f.repeat=x,A=f.range=S,C=f.sequence=A,f.Sequence=C);f.AsyncSequence=y;var m={};Object.defineProperty(m,"__esModule",{value:!0});var v=(b=void 0,w=m.increment=b,k=m.add=w,m.subtract=k);m.sum=v;var b=function(e){return e+1};m.increment=b;var w=function(e,t){return void 0===t?t=>e+t:e+t};m.add=w;var k=function(e,t){return void 0===t?t=>t-e:e-t};function*E(e,t){for(;;)yield t,t=e(t)}m.subtract=k,v=(e,t)=>e+t,m.sum=v;var O=E;f.iterate=O;var x=function*(e){for(;;)yield e()};f.repeat=x;var S=function*(e,t,n=1){if(0===n)throw new Error("step can not be 0");if(void 0===t)yield*E(m.add(n),e);else{const r=Math.abs(n);t<e?yield*I(E(m.subtract(r),e),u.takeWhile((e=>e>=t))):yield*I(E(m.add(r),e),u.takeWhile((e=>e<=t)))}};function I(e,...t){return g.isIterable(e)?new T(e,t):g.isArrayLike(e)?new T(g.iterable(e),t):new j(e,t)}f.range=S;var A=I;f.sequence=A;class T{constructor(e,t){this.source=e,this.transducers=t}[Symbol.iterator](){return this.transducers.reduce(((e,t)=>t.sync(e)),this.source)[Symbol.iterator]()}}var C=T;f.Sequence=C;class j{constructor(e,t){this.source=e,this.transducers=t}[Symbol.asyncIterator](){return this.transducers.reduce(((e,t)=>t.async_(e)),this.source)[Symbol.asyncIterator]()}}function P(e,t){return e<t?-1:e>t?1:0}y=j,f.AsyncSequence=y;var L=P;g.ascending=L;var q=function(e,t){return e<t?1:e>t?-1:0};g.descending=q;var M=function(...e){return(t,n)=>{for(const r of e){const e=r(t,n);if(0!=e)return e}return 0}};g.comparators=M;var R=function(e){return Object.assign((t=>t[e]),{name:e})};g.key=R;var B=function(e){return t=>t[e]};function H(e){return"object"==typeof e&&Symbol.iterator in e}g.value=B;var _=H;g.isIterable=_;var z=function(e){return"object"==typeof e&&Symbol.asyncIterator in e};g.isAsyncIterable=z;var N=function(e){return"object"==typeof e&&"then"in e};g.isPromiseLike=N;var D=function(...e){return e};g.toIterable=D;var F=function*(e){for(let t=0;t<e.length;t++)yield e[t]};function W(e){return"object"==typeof e&&"number"==typeof e.length}g.iterable=F;var $=W;g.isArrayLike=$;var U=function(e,...t){return H(e)||W(e)?function(e){const t=[];for(const n of e)t.push(n);return t}(f.sequence(e,...t)):function(e){var t,n,i,o;return r(this,void 0,void 0,(function*(){const r=[];try{for(t=c(e);!(n=yield t.next()).done;){const e=n.value;r.push(e)}}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i.error}}return r}))}(f.sequence(e,...t))};g.array=U;var V=function(e){return s(this,arguments,(function*(){yield yield o(e)}))};g.toAsyncIterable=V;var G=function(e,t=P){return"function"==typeof e?function(e,t=P){return(n,r)=>t(e(n),e(r))}(e,t):function(e,t=P){return(n,r)=>t(n[e],r[e])}(e,t)};g.by=G,p=function(e,...t){return H(e)?function(e){for(const t of e)return t;throw new Error("Expected a single value")}(f.sequence(e,...t)):function(e){var t,n,i,o;return r(this,void 0,void 0,(function*(){try{for(t=c(e);!(n=yield t.next()).done;){return n.value}}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i.error}}throw new Error("Expected a single value")}))}(f.sequence(e,...t))},g.single=p;var K={};Object.defineProperty(K,"__esModule",{value:!0});var J=void 0;K.AVLTree=J;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});var X=(Q=void 0,te=Z.replace=Q,Z.lazy=te);function Y(e,t,n){return Object.defineProperty(e,t,{value:n})}Z.container=X;var Q=Y;function ee(e,t,n){if(void 0===n.get)throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(e,t,Object.assign(Object.assign({},n),{get(){return Y(this,t,n.get.call(this))[t]}}))}Z.replace=Q;var te=ee;Z.lazy=te,X=function(e){return Object.keys(e).reduce(((t,n)=>ee(t,n,{configurable:!0,get:()=>e[n](t)})),{})},Z.container=X;class ne{constructor(e){this.comparator=e}static empty(e=g.ascending){return new re(e)}static create(e,t,n=g.ascending){const r=ne.empty(n);return new ie(n,e,t,r,r)}static of(e,t=g.ascending){return ne.preSorted(e.sort(g.by(0)),t,ne.empty(t))}static preSorted(e,t,n){const r=e.length;switch(r){case 0:return n;case 1:{const[[r,i]]=e;return new ie(t,r,i,n,n)}default:{const i=Math.floor(r/2),o=ne.preSorted(e.slice(0,i),t,n),s=ne.preSorted(e.slice(i+1),t,n),[a,c]=e[i];return new ie(t,a,c,o,s)}}}}J=ne,K.AVLTree=J;class re extends ne{constructor(e){super(e),this.isEmpty=!0,this.height=0,this.balance=0}insert(e,t){return new ie(this.comparator,e,t,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}}class ie extends ne{constructor(e,t,n,r,i){super(e),this.key=t,this.value=n,this.left=r,this.right=i,this.isEmpty=!1}insert(e,t){const n=this.comparator(e,this.key);return 0===n?new ie(this.comparator,e,t,this.left,this.right):n<0?this.replaceLeft(this.left.insert(e,t)):this.replaceRight(this.right.insert(e,t))}contains(e){const t=this.comparator(e,this.key);return 0===t||(t<0?this.left.contains(e):this.right.contains(e))}lookup(e){const t=this.comparator(e,this.key);return 0===t?this.value:t<0?this.left.lookup(e):this.right.lookup(e)}delete(e){const t=this.comparator(e,this.key);if(0===t){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};const{tree:e,key:t,value:n}=this.left.removeLast();return{tree:oe(new ie(this.comparator,t,n,e,this.right)),key:this.key,value:this.value}}if(t<0){const{tree:t,key:n,value:r}=this.left.delete(e);return{tree:this.replaceLeft(t),key:n,value:r}}const{tree:n,key:r,value:i}=this.right.delete(e);return{tree:this.replaceRight(n),key:r,value:i}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};const{tree:e,key:t,value:n}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:t,value:n}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};const{tree:e,key:t,value:n}=this.right.removeLast();return{tree:this.replaceRight(e),key:t,value:n}}replaceLeft(e){return oe(new ie(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return oe(new ie(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}}function oe(e){const t=e.balance;return-2==t?function(e){const t=e.right.balance;return 1==t?function(e){const t=le(e.right);return ae(e.replaceRight(t))}(e):-1==t?ae(e):e}(e):2==t?function(e){const t=e.left.balance;return-1==t?function(e){const t=ce(e.left);return se(e.replaceLeft(t))}(e):1==t?se(e):e}(e):e}function se(e){return le(e)}function ae(e){return ce(e)}function ce(e){const t=e.right,n=t.left,r=e.replaceRight(n);return t.replaceLeft(r)}function le(e){const t=e.left,n=t.right,r=e.replaceLeft(n);return t.replaceRight(r)}t([Z.lazy],ie.prototype,"balance",null),t([Z.lazy],ie.prototype,"height",null);class de{async_(e){return e}sync(e){return e}}var ue=de;function he(){return new de}u.IdentityTransducer=ue;var ge=he;u.identity=ge;var pe=he;u.transducer=pe;class fe{async_(e){return s(this,arguments,(function*(){var t,n;try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;return yield o(yield yield o(e))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)return yield t}}var ye=fe;function me(){return new fe}u.FirstTransducer=ye;var ve=me;u.first=ve;class be{async_(e){return s(this,arguments,(function*(){var t,n;let r;try{for(var i,s=c(e);!(i=yield o(s.next())).done;)r=i.value}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&(yield o(n.call(s)))}finally{if(t)throw t.error}}void 0!==r&&(yield yield o(r))}))}*sync(e){let t;for(t of e);void 0!==t&&(yield t)}}var we=be;function ke(){return new be}u.LastTransducer=we;var Ee=ke;u.last=Ee;class Oe{constructor(e){this.mapper=e}async_(e){return s(this,arguments,(function*(){var t,n;try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;yield yield o(this.mapper(e))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)yield this.mapper(t)}}var xe=Oe;u.MapTransducer=xe;var Se=function(e){return new Oe(e)};u.map=Se;class Ie{constructor(e){this.other=e}async_(e){return s(this,arguments,(function*(){if(!g.isAsyncIterable(this.other))throw new Error("Unsupported operation exception");const t=e[Symbol.asyncIterator](),n=this.other[Symbol.asyncIterator]();for(;;){const[e,r]=yield o(Promise.all([t.next(),n.next()]));if(e.done||r.done)return yield o(void 0);yield yield o([e.value,r.value])}}))}*sync(e){if(!g.isIterable(this.other))throw new Error("Unsupported operation exception");const t=e[Symbol.iterator](),n=this.other[Symbol.iterator]();for(;;){const e=t.next(),r=n.next();if(e.done||r.done)return;yield[e.value,r.value]}}}var Ae=Ie;u.ZipTransducer=Ae;var Te=function(e){return new Ie(e)};u.zip=Te;var Ce=function(){return new Ie(f.range(0))};u.zipWithIndex=Ce;class je{constructor(e){this.mapper=e}async_(e){return s(this,arguments,(function*(){var t,n;try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;yield o(yield*a(c(this.mapper(e))))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)yield*this.mapper(t)}}var Pe=je;u.FlatMapTransducer=Pe;var Le=function(e){return new je(e)};u.flatMap=Le;class qe{constructor(e){this.predicate=e}async_(e){return s(this,arguments,(function*(){var t,n;try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;this.predicate(e)&&(yield yield o(e))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)this.predicate(t)&&(yield t)}}var Me=qe;function Re(e){return new qe(e)}u.FilterTransducer=Me;var Be=Re;u.filter=Be;var He=function(e){return new qe((t=>!e(t)))};u.reject=He;var _e=function(e){return De(Re(e),me())};u.find=_e;class ze{constructor(e,t){this.a=e,this.b=t}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}}var Ne=ze;function De(e,t){return new ze(e,t)}u.CompositeTransducer=Ne;var Fe=De;u.compose=Fe;var We=function*e(t){t instanceof ze?(yield*e(t.a),yield*e(t.b)):yield t};u.decompose=We;class $e{constructor(e,t){this.reducer=e,this.seed=t}async_(e){return s(this,arguments,(function*(){var t,n;let r=this.seed;yield yield o(r);try{for(var i,s=c(e);!(i=yield o(s.next())).done;){const e=i.value;yield yield o(r=this.reducer(r,e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&(yield o(n.call(s)))}finally{if(t)throw t.error}}}))}*sync(e){let t=this.seed;yield t;for(const n of e)yield t=this.reducer(t,n)}}var Ue=$e;function Ve(e,t){return new $e(e,t)}u.ScanTransducer=Ue;var Ge=Ve;u.scan=Ge;var Ke=function(e,t){return De(Ve(e,t),ke())};u.reduce=Ke;class Je{constructor(e){this.count=e}async_(e){return s(this,arguments,(function*(){var t,n;if(this.count<1)return yield o(void 0);try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;if(yield yield o(e),--this.count<1)return yield o(void 0)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){if(!(this.count<1))for(const t of e)if(yield t,--this.count<1)return}}var Ze=Je;u.TakeTransducer=Ze;var Xe=function(e){return new Je(e)};u.take=Xe;class Ye{constructor(e){this.count=e}async_(e){return s(this,arguments,(function*(){var t,n;try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;--this.count<0&&(yield yield o(e))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)--this.count<0&&(yield t)}}var Qe=Ye;u.DropTransducer=Qe;var et=function(e){return new Ye(e)};u.drop=et;class tt{constructor(e){this.predicate=e}async_(e){return s(this,arguments,(function*(){var t,n;let r=!0;try{for(var i,s=c(e);!(i=yield o(s.next())).done;){const e=i.value;r&&(r=this.predicate(e)),r||(yield yield o(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&(yield o(n.call(s)))}finally{if(t)throw t.error}}}))}*sync(e){let t=!0;for(const n of e)t&&(t=this.predicate(n)),t||(yield n)}}var nt=tt;u.DropWhileTransducer=nt;var rt=function(e){return new tt(e)};u.dropWhile=rt;class it{constructor(e){this.predicate=e}async_(e){return s(this,arguments,(function*(){var t,n;try{for(var r,i=c(e);!(r=yield o(i.next())).done;){const e=r.value;if(!this.predicate(e))return yield o(void 0);yield yield o(e)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&(yield o(n.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e){if(!this.predicate(t))return;yield t}}}var ot=it;u.TakeWhileTransducer=ot;var st=function(e){return new it(e)};u.takeWhile=st;class at{constructor(e){this.comparator=e}async_(e){return s(this,arguments,(function*(){const t=yield o(g.array(e));t.sort(this.comparator),yield o(yield*a(c(t)))}))}*sync(e){const t=g.array(e);t.sort(this.comparator),yield*t}}var ct=at;u.SortTransducer=ct;var lt=function(e=g.ascending){return new at(e)};u.sort=lt;class dt{constructor(e){this.comparator=e}async_(e){return s(this,arguments,(function*(){var t,n;let r;try{for(var i,s=c(e);!(i=yield o(s.next())).done;){const e=i.value;(void 0===r||0!==this.comparator(e,r))&&(yield yield o(e)),r=e}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&(yield o(n.call(s)))}finally{if(t)throw t.error}}}))}*sync(e){let t;for(const n of e)(void 0===t||0!==this.comparator(n,t))&&(yield n),t=n}}var ut=dt;u.DedupTransducer=ut;var ht=function(e=g.ascending){return new dt(e)};u.dedupe=ht;class gt{constructor(e){this.comparator=e}async_(e){return s(this,arguments,(function*(){var t,n;let r=K.AVLTree.empty(this.comparator);try{for(var i,s=c(e);!(i=yield o(s.next())).done;){const e=i.value;r.contains(e)||(r=r.insert(e,void 0),yield yield o(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&(yield o(n.call(s)))}finally{if(t)throw t.error}}}))}*sync(e){let t=K.AVLTree.empty(this.comparator);for(const n of e)t.contains(n)||(t=t.insert(n,void 0),yield n)}}var pt=gt;u.UniqueTransducer=pt;var ft=function(e=g.ascending){return new gt(e)};u.unique=ft;var yt=function(e,t=1,n=!1){return new mt(e,t,n)};u.windowed=yt;class mt{constructor(e,t,n){this.size=e,this.step=t,this.remainder=n}async_(e){return s(this,arguments,(function*(){var t,n;let r=[],i=0;try{for(var s,a=c(e);!(s=yield o(a.next())).done;){const e=s.value;i>0?i--:(r.push(e),r.length===this.size&&(yield yield o([...r]),r=r.slice(this.step),this.step>this.size&&(i=this.step-this.size)))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&(yield o(n.call(a)))}finally{if(t)throw t.error}}this.remainder&&(yield yield o([...r]))}))}*sync(e){let t=[],n=0;for(const r of e)n>0?n--:(t.push(r),t.length===this.size&&(yield[...t],t=t.slice(this.step),this.step>this.size&&(n=this.step-this.size)));this.remainder&&(yield[...t])}}h=mt,u.WindowedTransducer=h;var vt=function(){var t=this,n={exports:this};function i(e){switch(typeof e){case"undefined":return!0;case"string":return""===e.trim();case"number":return isNaN(e);case"object":if(null==e)return!0;if(e.constructor===Object)return 0===Object.keys(e).length;if(Array.isArray(e))return 0===e.length}return!1}t.__esModule=!0,t.isEmpty=i;t.Strings=class{static noWhitespace(e){return e&&"string"==typeof e?e.replace(/\s+/g,""):""}static startWith(e,t){return e?e.substring(0,t.length)===t:e===t}static endsWith(e,t){return e.substring(e.length-t.length,e.length)===t}static isEmpty(e){return null==e||0===e.trim().length}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return e.replace(/([A-Z][a-z]+)/g,"$1-").toLowerCase().replace(/-$/,"")}};class o{static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map((t=>e[t]))}static entries(e){return Object.keys(e).map((t=>[t,e[t]]))}static removeEmpty(e){return e&&e.constructor===Object?Object.keys(e).reduce(((t,n)=>{const r=o.removeEmpty(e[n]);return i(r)||(t[n]=r),t}),{}):e}static sort(e){return e?Array.isArray(e)?e.map(o.sort):e.constructor===Object?Object.keys(e).sort().reduce(((t,n)=>{const r=e[n];return t[n]=o.sort(r),t}),{}):e:e}static toLowerCase(e){return"string"==typeof e?e.toLowerCase():Array.isArray(e)?e.map(o.toLowerCase):a((()=>e.constructor===Object))?Object.entries(e).reduce(((e,[t,n])=>(e[t]=o.toLowerCase(n),e)),{}):e}static omit(e,...t){return t.reduce(((e,t)=>(Reflect.deleteProperty(e,t),e)),e)}static pick(e,...t){return t.reduce(((t,n)=>(t[n]=e[n],t)),{})}}t.Objects=o;t.Maps=class{static entries(e){if(e.entries)return e.entries();const t=[];return e.forEach(((e,n)=>{t.push([n,e])})),t}};class s{static from(e){return Array.from(e)}static find(e,t){if(e.find)return e.find(t);const[n]=e.filter(t);return n}static toObject(e){return e.reduce(((e,t)=>(Object.keys(t).forEach((n=>{n in e||(e[n]=t[n])})),e)),{})}static flatten(e){return e.reduce(((e,t)=>e.concat(t)),[])}static flatMap(e,t){return e.flatMap?e.flatMap(t):s.flatten(e.map(t))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map((e=>e.trim()))}static includes(e,t){return"includes"in e?e.includes(t):-1!==e.indexOf(t)}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}}t.Arrays=s;function a(e,t){try{const n=e();return void 0===n?t:n}catch(e){return t}}function c(e,t){const n=t.toLowerCase(),r=s.find(Object.keys(e),(e=>e.toLowerCase()===n));if(!r)return;const i=e[r];return"string"==typeof i?i.trim():i}function l(e,...t){if(!e)return[];if(Array.isArray(e))return s.clean(s.flatten(e.map((e=>l(e,...t)))));if("object"==typeof e){const[n,...r]=t,i=c(e,n);return"object"==typeof i?l(i,...r):0===r.length&&Boolean(i)?[i]:[]}return[]}t.Elements=class{static path(e){let t=[e];for(;e.parentElement;)e=e.parentElement,t.push(e);return t}},t.get=a,t.getAsync=function(e,t){return r(this,void 0,void 0,(function*(){try{const n=yield e();return void 0===n?t:n}catch(e){return t}}))},t.getValue=c,t.getAll=l,t.extract=function(e,t){return s.flatten(t.map((t=>s.clean(s.unique(l(e,...t.split(".")))))))};const d="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:void 0!==n?n:Function("return this")();function h(e,t,n,r=(e=>e)){const i=[];let o,s=0;for(;null!=(o=e.exec(t));)i.push(r(t.substring(s,o.index))),i.push(n(o)),s=e.lastIndex;return i.push(r(t.substring(s))),i.join("")}function p(e){return e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()}t.globalThis=d,t.accumulateMultipleValues=function(e,t,n){const r=e[t];return void 0===r?e[t]=n:Array.isArray(r)?-1==r.indexOf(n)&&r.push(n):e[t]=[r,n],e},t.regexReplace=h,t.titleCase=function(e){return h(/\w+/g,e,(e=>p(e[0])))},t.caseWord=p,t.limit=function(e,t){return e.slice(0,t)};const f=/\s+/g;function y(e){return u.reduce(((t,n)=>{const[r,i]=e(n);return t[r]=i,t}),{})}function m(e){return e}return t.cleanSpaces=function(e){return e.trim().replace(f," ")},t.getClassName=function(e){return a((()=>s.last(e.constructor.name.split("$"))),"")},t.cleanText=function(e){return e?e.replace(/\s+/g," ").trim():""},t.zipObject=function(e,t){return g.single(e,u.zip(t),y(m))},t.toObject=y,t.identity=m,n.exports}.call({}),bt={};Object.defineProperty(bt,"__esModule",{value:!0});var wt=(Ot=void 0,bt.cache=Ot);bt.caching=wt;var kt,Et,Ot=function(e,t,n){if("function"!=typeof n.value)throw new Error("@cache can only decorate methods");const r=new WeakMap;return Object.defineProperty(e,t,Object.assign(Object.assign({},n),{value:function(...e){const t=JSON.stringify(e),i=function(e){const t=r.get(e);if(t)return t;const n=new Map;return r.set(e,n),n}(this),o=i.get(t);if(void 0!==o)return o;if(i.has(t))return o;const s=n.value.call(this,...e);return i.set(t,s),s}}))};function xt(e=vt.globalThis){return e.triptease=e.triptease||{},e.triptease.onboard=e.triptease.onboard||{},{triptease:e.triptease,onboard:e.triptease.onboard}}function St(e,t){return vt.get((()=>t.split(".").reduce(((e,t)=>e[t]),e)))}bt.cache=Ot,wt=function(e){const t=new Map;return function(...n){const r=JSON.stringify(n),i=t.get(r);if(void 0!==i)return i;if(t.has(r))return i;const o=e(...n);return t.set(r,o),o}},bt.caching=wt,(Et=kt||(kt={})).Native="native",Et.NonNative="non-native",Et.NotImplemented="not-implemented";class It{static exposeApi(){const e=xt(vt.globalThis).triptease;e.native||(e.native=It)}static getProperty(e){const t=St(vt.globalThis,e);return(null==(n=t)?kt.NotImplemented:"function"==typeof n?n.toString().includes("native code")?kt.Native:kt.NonNative:kt.Native)!==kt.NonNative?t:St(It.window,e);var n}static get window(){const e=vt.globalThis;if(!e.document)return e;try{const t=e.document,n=t.querySelector("[name='triptease.native']");if(n)return n.contentWindow;const r=t.createElement("iframe");return r.style.display="none",r.setAttribute("title","blank"),r.setAttribute("aria-hidden","true"),r.setAttribute("name","triptease.native"),t.documentElement.appendChild(r),r.contentWindow}catch(t){return e}}}t([bt.cache,n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Object)],It,"getProperty",null),t([Z.lazy,n("design:type",Object),n("design:paramtypes",[])],It,"window",null);const At=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function Tt(e,t,n){if(t(e))return n(e);switch(typeof e){case"undefined":return;case"object":if(null===e)return null;if(Array.isArray(e))return e.map((e=>Tt(e,t,n)));if(e.constructor===Object)return vt.Objects.keys(e).sort().reduce(((r,i)=>{const o=e[i];return r[i]=Tt(o,t,n),r}),{})}return e}const Ct=It.getProperty("JSON.parse"),jt=It.getProperty("JSON.stringify");class Pt{static parse(e){return Ct(e)}static parseWithDates(e){return function(e){return Tt(e,(e=>"string"==typeof e&&At.test(e)),(e=>{const t=new Date(e);return isNaN(t.valueOf())?e:t}))}(Pt.parse(e))}static stringify(e){return jt(this.validate(e))}static validate(e){return Tt(e,(e=>{const t=typeof e;switch(t){case"undefined":case"string":case"number":case"boolean":return!0;case"object":if(null===e)return!0;if(Array.isArray(e))return!1;if(e.constructor===Object)return!1;if("toJSON"in e)return!0}throw new Error(`Illegal JsonValue: ${t} ${e} `)}),(e=>e))}}class Lt{static same(e,t){return Pt.stringify(e)===Pt.stringify(t)}static isSuperset(e,t){return null===e||null===t?Lt.same(e,t):Array.isArray(e)&&Array.isArray(t)?!(e.length>t.length)&&e.every((e=>t.some((t=>Lt.isSuperset(e,t))))):vt.get((()=>e.constructor===Object))&&vt.get((()=>t.constructor===Object))?Object.keys(e).reduce(((n,r)=>n&&Lt.isSuperset(e[r],t[r])),!0):Lt.same(e,t)}static compress(e){const t=Lt.groupValues(e);return this.compressGrouped(t)}static compressGrouped(e){return Object.entries(e).reduce((({shared:e,unique:t},[n,r])=>{if(vt.get((()=>r.constructor===Object))){const i=Lt.compressGrouped(r);Object.keys(i.shared).length>0&&(e[n]=i.shared),i.unique.forEach(((e,r)=>{t[r]=t[r]||{},Object.keys(e).length>0&&(t[r][n]=e)}))}return Array.isArray(r)&&r.forEach(((i,o)=>{t[o]=t[o]||{},1===vt.Arrays.unique(r.map((e=>Pt.stringify(e)))).length?e[n]=i:void 0!==i&&(t[o][n]=i)})),{shared:e,unique:t}}),{shared:{},unique:[]})}static groupValues(e){const t=Array.from(e.reduce(((e,t)=>Object.keys(t).reduce(((e,t)=>e.add(t)),e)),new Set)),[n,r]=e.reduce(((e,n)=>t.reduce((([e,t],r)=>{const i=n[r];return vt.get((()=>i.constructor===Object))?(t[r]=t[r]||[],t[r].push(i)):(e[r]=e[r]||[],e[r].push(i)),[e,t]}),e)),[{},{}]),i=Object.entries(r).reduce(((e,[t,n])=>(e[t]=Lt.groupValues(n),e)),{});return Object.assign(Object.assign({},n),i)}static decompress(e){return e.unique.map((t=>this.merge(e.shared,t)))}static merge(e,t){return[...Object.keys(e),...Object.keys(t)].reduce(((n,r)=>{const i=e[r],o=t[r];return vt.get((()=>i.constructor===Object))&&vt.get((()=>o.constructor===Object))?n[r]=Lt.merge(i,o):n[r]=null!=o?o:i,n}),{})}}function qt(e,t=!0){return e?(0==e.indexOf("?")&&(e=e.substring(1,e.length)),e.split("&").map((function(e){return e.split("=")})).reduce((function(e,n){const r=n[0],i=n[1];if(!r)return e;const o=i?vt.get((()=>decodeURIComponent(i.replace(/\+/g,"%20"))),void 0):i,s=t?function(e){try{return Pt.parse(e)}catch(t){return e}}(o):o;return vt.accumulateMultipleValues(e,r,s)}),{})):{}}function Mt(e,t=!0){return Object.keys(vt.Objects.removeEmpty(e)).map((n=>{const r=e[n],i=t?function(e){return"string"==typeof e?e:JSON.stringify(e)}(r):r;return`${n}=${encodeURIComponent(i)}`})).join("&")}const Rt=It.getProperty("console.log"),Bt=It.getProperty("console.error"),Ht=It.getProperty("console.debug");class _t{constructor(e=Rt,t=Bt,n=Ht||Rt){this.log=e,this.error=t,this.debug=n}}class zt{constructor(){this.log=()=>{},this.error=()=>{},this.debug=()=>{}}}const Nt="triptease-debug";function Dt(e,t="triptease-debug"){const n=vt.get((()=>{var n;return qt(null===(n=e.location)||void 0===n?void 0:n.search,!1)[t]}))||vt.get((()=>{var n;return qt(new l(null===(n=e.location)||void 0===n?void 0:n.originalHref).query,!1)[t]}))||vt.get((()=>{var t,n;return null===(n=null===(t=e.process)||void 0===t?void 0:t.env)||void 0===n?void 0:n.DEBUG}))||vt.get((()=>{var n;return(null===(n=e.localStorage)||void 0===n?void 0:n.getItem)&&e.localStorage.getItem(t)}))||vt.get((()=>{var n;return(null===(n=e.sessionStorage)||void 0===n?void 0:n.getItem)&&e.sessionStorage.getItem(t)}))||"";return vt.get((()=>n.substring(0,256)),"")}function Ft(e){const t=e.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+t+"$")}function Wt(e,t=vt.globalThis){try{const n=function(e){return Dt(e,Nt).split(",").map((e=>e.trim()))}(t),r=n.filter((e=>"!"===e[0])).map((e=>e.substr(1)));return r.length>0?!r.some((t=>Ft(t).test(e))):n.some((t=>"true"===t||Ft(t).test(e)))}catch(e){return!1}}class $t{constructor(e){this.name=e,this.console=new _t}debug(e,...t){this.console.debug(`[${this.name}] ${e}`,...t)}log(e,...t){this.console.log(`[${this.name}] ${e}`,...t)}error(e,...t){this.console.error(`[${this.name}] ${e}`,...t)}}function Ut(e,t=vt.globalThis){return Wt(e,t)?new $t(e):new zt}class Vt{constructor(e,t){this.name=e,this.trackingApi=t,this.logger=Ut(e)}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t);try{this.trackingApi.trackError({name:this.name,message:e,args:t.map((e=>{return Yt(e)?{name:(t=e).name,message:t.message,stack:t.stack}:e;var t}))})}catch(e){this.logger.error("Failed to track error",e)}}log(e,...t){this.logger.log(e,...t)}}class Gt{constructor(e,t,n=Kt,r=Ut("messaging")){this.listener=e,this.target=t,this.allowedOrigins=n,this.logger=r}addListener(e){this.listener&&this.listener.addEventListener("message",(t=>{this.disallowedOrigin(t)||function(e){try{const{target:t,method:n}=Zt(e.type);if(t&&n)return!0}catch(e){}return!1}(t.data)&&e(t.data,new Gt(void 0,t.source||this.target))}))}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&-1===this.allowedOrigins.indexOf(new l(e.origin).host)}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(t){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}}const Kt=["onboard.triptease.io","localhost"],Jt=/^(.*)\.([^.]+)$/;function Zt(e){const[,t,n]=e.match(Jt)||[];return{target:t,method:n}}function Xt(e){const t={};return function(...n){const r=JSON.stringify(n),i=t[r];return void 0!==i?i:t[r]=e(...n)}}function Yt(e){return e&&"object"==typeof e&&"name"in e&&"string"==typeof e.name&&"message"in e&&"string"==typeof e.message&&"stack"in e&&"string"==typeof e.stack}function Qt(e,t,n){return{name:e,message:t,stack:null!=n?n:""}}var en,tn,nn,rn,on,sn,an={};function cn(e){return e&&"object"==typeof e&&e.constructor===Object&&"string"==typeof e["@type"]}function ln(e,t){return cn(e)&&t(e["@type"])}function dn(e){return e&&"object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.type&&"string"==typeof e.url}an.isIdentifierSource=function(e){return"object"==typeof e&&"source"in e&&"identifier"in e&&"type"in e},an.isOtherSource=function(e){return"object"==typeof e&&"identifier"in e&&"Other"==e.identifier},an.isStructuredData=cn,an.isStructuredDataType=ln,an.isLodgingReservation=function(e){return ln(e,(e=>"LodgingReservation"===e))},an.isClientSideApplication=dn,an.PageType=nn,(rn=nn||(en=nn={},an.PageType=nn,en)).Search="Search",rn.RoomsAndRates="RoomsAndRates",rn.Confirmation="Confirmation",rn.Payment="Payment",rn.Group="Group",rn.Partial="Partial",rn.Unknown="Unknown",an.KernelMode=on,(sn=on||(tn=on={},an.KernelMode=on,tn)).Singleton="Singleton",sn.ApplicationHost="ApplicationHost",sn.DataSource="DataSource";an.BootstrapName="triptease.onboard.bootstrap";an.KernelHostName="triptease.onboard.kernel-host";const un="triptease.onboard.kernel";an.KernelName=un,an.isScrapedIdentifiers=function(e){return!!e&&("object"==typeof e&&("integrationId"in e||"clientKey"in e||"apiKey"in e||"identifiers"in e||"type"in e))};class hn{static get(){return vt.get((()=>{const e="4171.39649";return"v"+e}),"latest")}}function gn(e,t={credentials:!1}){return r(this,void 0,void 0,(function*(){if("undefined"!=typeof fetch){const n=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:t.credentials?"include":"omit"});return{status:n.status,statusDescription:n.statusText,body:yield n.text()}}{const n=new XMLHttpRequest;return n.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach((t=>{n.setRequestHeader(t,e.headers[t])})),n.withCredentials=t.credentials,n.send(e.body),new Promise(((e,t)=>{n.addEventListener("load",(t=>{e({status:n.status,statusDescription:n.statusText,body:n.responseText})})),n.addEventListener("error",(e=>{t(e)}))}))}}))}var pn,fn;class yn{constructor(e){this.logger=e,this.workers={}}createWorker(e,t){return r(this,void 0,void 0,(function*(){const n=this.workers[e];return n||(this.workers[e]=yield this.create(t,{name:e}))}))}create(e,t){return r(this,void 0,void 0,(function*(){try{return new Worker(e,t)}catch(n){this.logger.debug("Failed to create Worker switching to Blob Worker because:",n.message);const r=`location.originalHref = "${e}";\n`,i=(yield gn({method:"GET",url:e})).body,o=new Blob([r,i],{type:"application/javascript"});return new Worker(URL.createObjectURL(o),t)}}))}}class mn{constructor(e,t=Ut("application-starter"),n=new yn(t),r=new vn(e,t)){this.window=e,this.logging=t,this.workerFactory=n,this.waiter=r}start(e){return r(this,void 0,void 0,(function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);const t=this.window.document;if("worker"===e.type){const t=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,t)),this.logging.debug("ApplicationStarter returning worker"),t}const n=t.createElement(e.type);n.setAttribute("name",e.name),n.src=e.url;const r=mn.DefaultOptions[e.type]||{};return Object.keys(r).forEach((e=>{n.setAttribute(e.toLowerCase(),r[e])})),this.addElement(n),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):"script"===e.type&&(yield this.waiter.waitForLoadEvent(n)),n}))}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var t;const n=xt(e).triptease.onboard;return n.applicationStarter=null!==(t=n.applicationStarter)&&void 0!==t?t:new mn(e)}}mn.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},t([bt.cache,n("design:type",Function),n("design:paramtypes",["function"==typeof(pn=void 0!==an&&an.ClientSideApplication)?pn:Object]),n("design:returntype","function"==typeof(fn="undefined"!=typeof Promise&&Promise)?fn:Object)],mn.prototype,"start",null);class vn{constructor(e,t){this.window=e,this.logging=t}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise(((t,n)=>{e.addEventListener("load",t),e.addEventListener("error",(()=>n({name:"ScriptError",message:`Failed to load script "${e.src}"`})))}))}waitForMessage(e,t=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise((n=>{this.logging.debug("MessageWaiter creating handler");const r=i=>{try{const o=i.data&&i.data.type,s=o===e;this.logging.debug(`ApplicationStarter message received "${o}", expecting "${e}", matched: ${s}`),s&&(t.removeEventListener("message",r),n(i.data))}catch(e){this.logging.debug("ApplicationStarter error in parsing message",e,i)}};this.logging.debug("MessageWaiter adding listener"),t.addEventListener("message",r)}))}}var bn={};Object.defineProperty(bn,"__esModule",{value:!0});var wn=(kn=void 0,bn.SystemClock=kn);bn.StoppedClock=wn;var kn=class{now(){return new Date}};bn.SystemClock=kn;wn=class{constructor(e){this.value=e}now(){return this.value}},bn.StoppedClock=wn;class En{generate(e){return Cn(e)()}}function On(e){const t=new Error(e);return t.source="ulid",t}const xn="0123456789ABCDEFGHJKMNPQRSTVWXYZ",Sn=xn.length,In=Math.pow(2,48)-1;function An(e){let t=Math.floor(e()*Sn);return t===Sn&&(t=Sn-1),xn.charAt(t)}const Tn=vt.globalThis;function Cn(e=26,t=new bn.SystemClock,n=function(e=Tn.crypto){return()=>{try{const t=new Uint8Array(1);return e.getRandomValues(t),t[0]/255}catch(e){return Math.random()}}}()){return function(r){return(void 0===r||isNaN(r))&&(r=t.now().getTime()),function(e,t){if(isNaN(e))throw new Error(e+" must be a number");if(e>In)throw On("cannot encode time greater than "+In);if(e<0)throw On("time must be positive");if(!Number.isInteger(e))throw On("time must be an integer");let n,r="";for(;t>0;t--)n=e%Sn,r=xn.charAt(n)+r,e=(e-n)/Sn;return r}(r,10)+function(e,t){let n="";for(;e>0;e--)n=An(t)+n;return n}(function(e){if(e<10)throw new Error("Length must be at least 10 characters");return e-10}(e),n)}}const jn=Cn();class Pn{constructor(e,t=new bn.SystemClock,n=gn){this.window=e,this.clock=t,this.httpClient=n,this.domainUserIdName="tt-domain-user-id"}getIdentity(){return r(this,void 0,void 0,(function*(){const e=yield this.httpClient({url:"https://api.triptease.io/identity-service/identity",method:"GET"},{credentials:!0});return Object.assign(Object.assign({},Pt.parse(e.body)),{domainUserId:this.getDomainId()})}))}getDomainId(){try{const e=this.window.localStorage.getItem(this.domainUserIdName);if(e)return e}catch(e){}const e=jn();try{this.window.localStorage.setItem(this.domainUserIdName,e)}catch(e){}return e}}function Ln(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t}class qn{generate(e){if(void 0!==e)throw new Error("UuidGenerator does not support custom lengths");return Ln().replace(/-/g,"")}}class Mn{constructor(e,t){this.messaging=e,this.idGenerator=t}get(e,t,n){return(...e)=>r(this,void 0,void 0,(function*(){const n=this.idGenerator.generate(),{payload:r}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(t),payload:e,correlationId:n});if(Yt(r))throw r;return r}))}}function Rn(e,t=new qn){return new Proxy({},new Mn(e,t))}class Bn{constructor(e,t=Rn(e)){this.proxy=t,this.applicationConfig=Xt((e=>r(this,void 0,void 0,(function*(){return yield this.proxy.applicationConfig(e)})))),this.generateConfig=Xt((e=>r(this,void 0,void 0,(function*(){return yield this.proxy.generateConfig(e)}))))}}class Hn{constructor(){this.scripts=[]}static create(e){const t=xt(e).onboard,n=t.stackScriptFinder;return n||(t.stackScriptFinder=new Hn)}capture(){const e=function(){try{throw new Error}catch(e){if(!e.stack)return;const t=e.stack.match(_n);if(!t)return;const n=t[1];return new l(n)}}();e&&this.scripts.push(e)}get(){return this.scripts}}const _n=/(https?.*):\d+:\d+/;const zn=It.getProperty("Date");class Nn{now(){return new zn}}class Dn{now(){return new Date}}const Fn={name:"onboard",version:hn.get()};class Wn{constructor(e,t,n=Ut("analytics"),i=50){this.window=e,this.clock=t,this.logger=n,this.batchSize=i,this.queued=[],setInterval((()=>r(this,void 0,void 0,(function*(){return yield this.flush()}))),1e3),this.window.addEventListener("unload",(()=>r(this,void 0,void 0,(function*(){return yield this.flush()}))))}send(e){return r(this,void 0,void 0,(function*(){this.queued.push(function(e,t){return Object.assign({messageId:Ln(),createdAt:e.now()},t)}(this.clock,e)),this.queued.length>this.batchSize&&(yield this.flush())}))}flush(){return r(this,void 0,void 0,(function*(){if(0===this.queued.length)return;const e=this.queued.splice(0,this.batchSize);this.logger.log(`Flushing batch of ${e.length}, remaining in queue ${this.queued.length}`);!function({method:e="POST",url:t,body:n}){const r=JSON.stringify(n);if(void 0!==navigator.sendBeacon&&"POST"===e)navigator.sendBeacon(t,r);else if("undefined"!=typeof fetch)fetch(t,{method:e,body:r});else if(XMLHttpRequest){const n=new XMLHttpRequest;n.open(e,t,!0),n.send(r)}}({url:"https://onboard.triptease.io/message/batch",body:{type:"triptease.onboard.batch",sentAt:this.clock.now(),payload:e}})}))}}function $n(e){return{title:e.document.title,locale:e.document.documentElement.lang||e.document.documentElement.getAttribute("xml:lang")||"",url:e.location.href,urlParsed:Un(e.location.href),referrer:e.document.referrer,referrerParsed:Un(e.document.referrer),characterSet:e.document.characterSet,opener:vt.get((()=>Boolean(e.opener)),!1)}}function Un(e){if(!e)return{};const{scheme:t,host:n,path:r,query:i,fragment:o}=new l(e);return vt.Objects.removeEmpty({scheme:t,host:n,path:r,query:i,queryParsed:qt(i,!1),fragment:o})}class Vn{constructor(e,t=new Dn){this.window=e,this.clock=t;try{this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){this.timezone=""}}buildMessage(e){return r(this,void 0,void 0,(function*(){const t=vt.get((()=>this.window.triptease.onboard.bootstrap.identity),{}),n=this.clock.now();return Lt.merge({createdAt:n,messageId:Ln(),anonymousId:vt.get((()=>t.anonymousId)),userId:vt.get((()=>t.userId)),sessionId:vt.get((()=>t.sessionId)),domainUserId:vt.get((()=>t.domainUserId)),context:{library:Fn,userAgent:this.window.navigator.userAgent,locale:this.window.navigator.language,page:$n(this.window),screen:{width:this.window.screen.width,height:this.window.screen.height},timezone:this.timezone}},e)}))}}const Gn="triptease.onboard.response";function Kn(e){return e&&"object"==typeof e&&"triptease.onboard.request"===e.type&&"string"==typeof e.requestType&&"string"==typeof e.correlationId&&Array.isArray(e.payload)}function Jn(e){return e&&"object"==typeof e&&"triptease.onboard.response"===e.type&&"string"==typeof e.correlationId}function Zn(e,t){return{type:"triptease.onboard.response",correlationId:e,payload:t}}function Xn(e,t){return Zn(e,Qt("NotFound","No handler found for "+t))}const Yn=Ut("messaging");class Qn{constructor(){this.handlers=new Map}register(e,t){return e.forEach((e=>{if(this.hasHandlerFor(e))throw new Error(`Method name "${e}" already registered to a handler`);this.handlers.set(e,t)})),this}handle(e){return r(this,void 0,void 0,(function*(){const t=this.handlers.get(e.requestType);return t?(Yn.debug("Matched message to handler",e,t),yield t.handle(e)):Xn(e.correlationId,e.requestType)}))}hasHandlerFor(e){return this.handlers.has(e)}}const er=Ut("messaging");class tr{constructor(e){this.target=e}handle(e){return r(this,void 0,void 0,(function*(){const t=this.target[e.requestType];if(!t)return er.debug("No method found that matches method",e.requestType,this.target),Xn(e.correlationId,e.requestType);try{er.debug("Found method",e.requestType);const n=yield t.apply(this.target,e.payload);return Zn(e.correlationId,n)}catch(t){return er.debug("Error trying to in invoke method",e.requestType,t),function(e,t){return Zn(e,Qt(t.name,t.message,t.stack))}(e.correlationId,t)}}))}}function nr(e,...t){const n=vt.getAll(e,...t);if(!n)return;const[r]=[...n].reverse();return r}function rr(e){const t=vt.get((()=>function(e){const t=e.hostname.toLowerCase(),n=e.href.toLowerCase(),r=e.pathname.toLowerCase();return"gc.synxis.com"===t?"SynxisV1":"be.synxis.com"===t?"SynxisV2":-1!==t.indexOf("travelclick")?"TravelClick":-1!==t.indexOf("bookingbutton")||-1!==t.indexOf("book-directonline")||-1!==t.indexOf("direct-book.com")?"SiteMinder":-1!==t.indexOf("firmdalehotels")?"Firmdale":-1!==t.indexOf("apxhotelsapartments")||-1!==t.indexOf("mews.li")?"Mews":-1!==t.indexOf("guestline.net")||-1!==t.indexOf("roomlynx.net")?"Guestline":-1!==t.indexOf("theluxcollective.com")||-1!==t.indexOf("luxresorts.com")?"Lux":-1!==t.indexOf("book-onlinenow.net")?"BookOnlineNow":-1!==t.indexOf("windsurfercrs.com")?"SHR":-1!==t.indexOf("leonardo-hotels")?"Leonardo":-1!==t.indexOf("bestwestern.fr")?"BestWesternFrance":-1!==t.indexOf("imperatore.it")?"Imperatore":-1!==t.indexOf("walkerhill.com")?"Walkerhill":-1!==n.indexOf("webrez.com")||-1!==t.indexOf("worldweb.com")||-1!==t.indexOf("webrez.com/v")?"WebRezPro":-1!==t.indexOf("hoteliers.com")?"Hoteliers":-1!==t.indexOf("doylecollection")?"DoyleCollection":-1!==n.indexOf("/bookcore/")?"Roiback":-1!==t.indexOf("nativeplaces.com")?"NativePlaces":-1!==t.indexOf("fattal-hotels")?"Fattal":-1!==n.indexOf("/cgi-bin/lansaweb")?"StationCasinosV1":"www.palms.com"===t?"StationCasinosV2":-1!==t.indexOf(".webhotel.")?"Opera":-1!==t.indexOf("constancehotels.com")?"ConstanceHotels":-1!==t.indexOf("online.bookvisit.")?"BookVisit":-1!==t.indexOf("direct-reservation")?"BusyRooms":-1!==t.indexOf("youngshotels")?"Youngs":"reservations.thekingsburyhotel.com"===t||"bookings.amayaresorts.com"===t?"Hayleys":-1!==t.indexOf("www.secure-res.com")?"Vizergy":-1!==t.indexOf("loewshotels")?"Loews":-1!==n.indexOf("bookings.hamiltonisland.com.au/m/")?"HamiltonIslandMobile":-1!==n.indexOf("bookings.hamiltonisland.com.au/")?"HamiltonIsland":-1!==t.indexOf("regalhotel")?"RegalHotels":-1!==t.indexOf("marinabaysands")?"MarinaBaySands":-1!==t.indexOf("live.high-level-software")?"HighLevelSoftware":-1!==t.indexOf("book.my-rez")?"MyRez":-1!==t.indexOf("premiereserve.com")||-1!==t.indexOf("teg-hotels.com")?"Everly":-1!==t.indexOf("simplebooking")||-1!==t.indexOf("booking.crimsonhotel")?"SimpleBooking":-1!==t.indexOf("bookassist.com")?"BookAssist":-1!==t.indexOf("swissotel.com")?"Swissotel":-1!==t.indexOf("booking.africaalbidatourism.com")?"AfricaAlbida":-1!==t.indexOf("pphotels.com")||-1!==t.indexOf("erez.mmcmg.net")?"PrimePlaza":-1!==t.indexOf("onepagebooking.com")?"HotelNetSolutions":-1!==t.indexOf("reservhotel.com")?"ReserveHotel":-1!==t.indexOf("thorbooking.com")?"ThinkIn":-1!==n.indexOf("/irmng")?"IRM":-1!==t.indexOf("booking-channel.com")?"Hotusa":"www.venetian.com"===t?"Sandsvegas":"bookingresults.com"===t?"Silverbyte":-1!==t.indexOf("clock-software.com")||-1!==t.indexOf("villasriomar.com")?"Clock":-1!==t.indexOf("tajinnercircle.com")||-1!==t.indexOf("tajhotels.com")?"Taj":-1!==t.indexOf("booking.iberostartheclub.com")?"Iberostar":-1!==t.indexOf("services.comwell.com")?"Comwell":-1!==t.indexOf("elinapms.com")?"Elina":-1!==t.indexOf("booking.profitroom.com")?"Profitroom":-1!==t.indexOf("bookingexpert.it")?"Bookingexpert":-1!==t.indexOf("cloud-reservations.net")?"Hart":-1!==t.indexOf("irm1.net")||0===r.indexOf("/irmnet/")?"RDP":-1!==t.indexOf("pr.palaceresorts.com")||-1!==t.indexOf("pr.moonpalace.com")||-1!==t.indexOf("pr.leblancsparesorts.com")?"PalaceResorts":-1!==t.indexOf(".palaceresorts.com")||-1!==t.indexOf(".moonpalace.com")||-1!==t.indexOf(".leblancsparesorts.com")||-1!==t.indexOf(".beachviewbarbados.com")||-1!==t.indexOf(".oceantwobarbados.com")||-1!==t.indexOf(".sea-breeze.com")||-1!==t.indexOf(".southbeachbarbados.com")?"Kognitiv":-1!==t.indexOf(".iqwebbook.com")?"Innquest":-1!==t.indexOf("theguild.co")?"Guild":-1!==t.indexOf(".innroad.com")?"Innroad":-1!==t.indexOf(".furama.com")?"Furama":-1!==t.indexOf(".reztrip.com")?"Reztrip":-1!==t.indexOf("nisekoportfolio.com")?"Bookeasy":-1!==t.indexOf("azimuthotels")&&-1===t.indexOf("reservations")?"Azimut":-1!==t.indexOf(".steigenberger.com")||-1!==t.indexOf(".intercityhotel.com")||-1!==t.indexOf(".maxxhotel.com")||-1!==t.indexOf(".jaz-hotel.com")?"DeutscheHospitality":-1!==t.indexOf(".cloudbeds.com")?"CloudBeds":-1!==t.indexOf("coasthotels.com")?"Amadeus":-1!==t.indexOf(".thehoxton.com")?"Hoxton":-1!==t.indexOf(".lottehotel.com")?"LotteHotel":-1!==t.indexOf("kempinski.com")?"Kempinski":-1!==t.indexOf("derquebooking")?"DerqueBooking":-1!==t.indexOf("ovolohotels.com")?"Ovolo":-1!==t.indexOf(".gleneagles.com")?"Gleneagles":-1!==t.indexOf(".redplanethotels.com")?"RedPlanet":-1!==t.indexOf(".banffjaspercollection.com")||-1!==t.indexOf(".glacierparkcollection.com")?"PursuitCollection":-1!==t.indexOf(".bestwestern.co.uk")?"BestWesternUk":-1!==t.indexOf(".sbe.com")?"Sbe":-1!==t.indexOf(".bode.co")?"Bode":-1!==t.indexOf(".reserve-online.net")?"ReserveOnline":-1!==t.indexOf("secure-hotel-booking.com")?"Availpro":-1!==t.indexOf(".syshotelonline.it")?"SysHotelOnline":-1!==t.indexOf(".reservit.com")?"Reservit":-1!==t.indexOf(".vinpearl.com")?"Vinpearl":-1!==t.indexOf(".omnibees.com")?"Omnibees":-1!==t.indexOf(".hipotels.com")?"Hipotels":-1!==t.indexOf(".handpickedhotels.co.uk")?"HandPickedHotels":-1!==t.indexOf("bookings.zafirohotels.com")?"Zafiro":-1!==t.indexOf(".viatocrs.de")?"Viato":-1!==t.indexOf(".easy-booking.")?"EasyBooking":-1!==t.indexOf(".ipms247.")||-1!==t.indexOf("reservas.hotelkokai.com")?"Ezee":-1!==t.indexOf(".innstyle.")?"InnStyle":-1!==t.indexOf(".book-secure.")?"FastBooking":-1!==t.indexOf(".cityexpress.")?"CityExpress":-1!==t.indexOf(".hoteleasyreservations.")?"EasyConsulting":-1!==t.indexOf(".travelanium.")?"Travelanium":-1!==t.indexOf(".e-gds.")?"EGds":-1!==t.indexOf(".booking.com")?"Booking":-1!==t.indexOf(".iperbooking.")?"Iperbooking":-1!==t.indexOf(".okuhotels.")?"OKU":void 0}(e.location)));if(t)return{bookingEngine:t};const n=vt.get((()=>function(e){if(e.document.querySelector('link[href*="be.synxis.com"]'))return"SynxisV2";if(vt.get((()=>Object.keys(e._GlobalTokens).length),0))return 1==(Boolean(e.document.querySelector("#XbeViewPanel"))?1:2)?"SynxisV1":"SynxisV2";return vt.get((()=>-1!==e.process.env.APPLICATION_URL.indexOf("be.synxis.com")),!1)?"SynxisV2":vt.get((()=>-1!==e.apiUrl.indexOf("travelclick")),!1)||vt.get((()=>!!nr(e.dataLayer,"ihHotelID")),!1)||vt.get((()=>!!vt.Arrays.find(vt.Arrays.from(e.document.querySelectorAll('script[type="text/javascript"]')).map((e=>e.textContent)),(e=>-1!==e.indexOf("travelclick")))),!1)?"TravelClick":vt.get((()=>e.document.querySelector('link[href*="vendors~about~booking~cancellation~checkout~confirmation~contact~policies~reservation"]')))||vt.get((()=>"Modern"===nr(e.dataLayer,"booking_engine")))||vt.get((()=>nr(e.dataLayer,"tbb_prefix")))||vt.get((()=>nr(e.dataLayer,"virtual_url")))||vt.get((()=>e.document.querySelector('meta[name="occupancy-includes-infants"]')))||vt.get((()=>!!e.digitalPartner.triptease))?"SiteMinder":vt.get((()=>e.dataLayer.some((e=>e.neobookings))),!1)?"NeoBookings":vt.get((()=>"smart"===nr(e.dataLayer,"context.application")),!1)?"Availpro":vt.get((()=>Boolean(e.document.querySelectorAll("iframe.mews-distributor").length)),!1)?"Mews":vt.get((()=>Boolean(e.WSMAIN)),!1)?"SHR":vt.get((()=>0!==vt.Arrays.from(e.document.querySelectorAll("script")).filter((e=>-1!==e.src.indexOf("js/ehors"))).length),!1)?"EHORS":vt.get((()=>e.document.querySelector("#clienId")),void 0)?"RMSCloud":null!==e.document.querySelector("body#ElinaPBE")?"Elina":null!==e.document.getElementById("bookingGadget")?"GuestCentric":Boolean(e.document.querySelector('div[id^="phMasterBody_"]'))?"UIBScrs":Boolean(e.document.querySelector('script[src*="UiBSJs"]'))?"UIBScrsV2":vt.get((()=>Boolean(e.Mirai)),!1)?"Mirai":"paraty"===e.MAIN_SITE?"Paraty":e.document.querySelector('[href^="https://www.booking2hotels.com"]')||e.document.querySelector('.booking-engine img[src*="booking2hotels"]')?"Booking2Hotels":e.document.querySelector('script[src*="seekda"]')?"Seekda":e.document.querySelector('meta[name="author"][content*="alaric"]')?"Alaric":vt.get((()=>-1!==e.top.location.hostname.toLowerCase().indexOf("hotel-llevant")),!1)?"Prestige":vt.get((()=>-1!==e.document.querySelector('meta[name="description"]').content.indexOf("reztrip")),!1)?"Reztrip":vt.get((()=>!!e.PROTELWBE5),!1)?"Protel":vt.get((()=>-1!==e.document.title.indexOf("ThinkIn")))||e.RFH_Room_Booking?"ThinkIn":vt.get((()=>e.document.querySelector('link[href*="/bookvisit/"]')))?"BookVisit":vt.get((()=>e.document.querySelector('link[href*="webhotelier.net"]')))?"ReserveOnline":vt.get((()=>e.document.querySelector("#availpro-tracker")))?"Availpro":vt.get((()=>e.document.querySelector("meta[name=Author][content*=RESERVIT]")))?"Reservit":vt.get((()=>e.document.querySelector("#eZee_BookingContainer, #eZee_BookingHeader, #eZee_BookingFilter, #eZ_BookingRooms")))?"Ezee":vt.get((()=>e.document.querySelector("img[src*=hotetec],a[href*=hotetec]")))?"Hotetec":vt.get((()=>e.document.querySelector("link[href*=cityexpress]")))?"CityExpress":vt.get((()=>e.document.querySelector("link[href*=travelanium]")))?"Travelanium":vt.get((()=>e.document.querySelector('a[href*=".e-gds."],img[src*=".e-gds."]')))?"EGds":void 0}(e)));if(n)return{bookingEngine:n};const r=function(e){const t=e.querySelector('script[src*="static.triptease.io/client-integrations/"]');if(!t)return;const n=t.src,r=n.match(/\/([^/]+).js$/);if(!r)return;const i=r[1];return i?{bookingEngine:i.toLowerCase(),originalUrl:n}:void 0}(e.document);return r||(i=e.document,{bookingEngine:vt.get((()=>i.querySelector('script[src*="onboard.triptease.io/bootstrap.js"]').src.match(/fallback=([a-zA-Z]+)/)[1]),"Default")});var i}const ir=hn.get();function or(e){return`https://onboard.triptease.io/integrations/${ir}/${e}.js`}function sr(e){return`https://integration.triptease.io/client-integrations/platform/${e}.js`}const ar=[{bookingEngine:"Default",script:or("default")},{bookingEngine:"Generic",script:or("generic")},{bookingEngine:"SynxisV1",script:or("synxis-v1")},{bookingEngine:"SynxisV2",script:or("synxis-v2")},{bookingEngine:"TravelClick",script:or("travelclick")},{bookingEngine:"iHotelierV2",script:or("travelclick")},{bookingEngine:"Firmdale",script:or("firmdale")},{bookingEngine:"SiteMinder",script:or("siteminder")},{bookingEngine:"Mews",script:or("mews")},{bookingEngine:"Guestline",script:or("guestline")},{bookingEngine:"Lux",script:sr("lux")},{bookingEngine:"BookOnlineNow",script:or("book-online-now")},{bookingEngine:"SHR",script:or("shr")},{bookingEngine:"Leonardo",script:sr("leonardo")},{bookingEngine:"BestWesternFrance",script:sr("best-western-france")},{bookingEngine:"Imperatore",script:sr("imperatore")},{bookingEngine:"Walkerhill",script:sr("walkerhill")},{bookingEngine:"WebRezPro",script:or("webrezpro")},{bookingEngine:"Hoteliers",script:sr("hoteliers")},{bookingEngine:"RMSCloud",script:sr("rmscloud")},{bookingEngine:"DoyleCollection",script:sr("doyle-collection")},{bookingEngine:"Elina",script:sr("elina")},{bookingEngine:"EHORS",script:sr("ehors")},{bookingEngine:"UIBScrs",script:sr("uibscrs")},{bookingEngine:"UIBScrsV2",script:or("uibscrs")},{bookingEngine:"Roiback",script:or("roiback")},{bookingEngine:"NativePlaces",script:sr("native-places")},{bookingEngine:"Mirai",script:or("mirai")},{bookingEngine:"Fattal",script:sr("fattal")},{bookingEngine:"Opera",script:or("opera")},{bookingEngine:"BookVisit",script:or("book-visit")},{bookingEngine:"GuestCentric",script:or("guest-centric")},{bookingEngine:"BusyRooms",script:sr("busy-rooms")},{bookingEngine:"Youngs",script:or("youngs")},{bookingEngine:"Hayleys",script:sr("hayleys")},{bookingEngine:"Hotetec",script:or("hotetec")},{bookingEngine:"Vizergy",script:sr("vizergy")},{bookingEngine:"Loews",script:or("loews")},{bookingEngine:"HamiltonIslandMobile",script:sr("hamilton-island-mobile")},{bookingEngine:"HamiltonIsland",script:or("hamiltonisland")},{bookingEngine:"RegalHotels",script:or("regal-hotels")},{bookingEngine:"HighLevelSoftware",script:sr("high-level-software")},{bookingEngine:"MarinaBaySands",script:sr("marina-bay-sands")},{bookingEngine:"MyRez",script:sr("my-rez")},{bookingEngine:"Everly",script:sr("everly")},{bookingEngine:"SimpleBooking",script:or("simple-booking")},{bookingEngine:"BookAssist",script:or("bookassist")},{bookingEngine:"Swissotel",script:sr("swissotel")},{bookingEngine:"PrimePlaza",script:sr("prime-plaza")},{bookingEngine:"HotelNetSolutions",script:or("hotel-net-solutions")},{bookingEngine:"ReserveHotel",script:or("reserve-hotel")},{bookingEngine:"NeoBookings",script:or("neo-bookings")},{bookingEngine:"IRM",script:sr("irm")},{bookingEngine:"Hotusa",script:sr("hotusa")},{bookingEngine:"ThinkIn",script:sr("thinkin")},{bookingEngine:"Sandsvegas",script:sr("sandsvegas")},{bookingEngine:"Paraty",script:or("paraty")},{bookingEngine:"Silverbyte",script:sr("silverbyte")},{bookingEngine:"Clock",script:sr("clock")},{bookingEngine:"Iberostar",script:sr("iberostar")},{bookingEngine:"AfricaAlbida",script:or("africa-albida")},{bookingEngine:"ConstanceHotels",script:or("constance-hotels")},{bookingEngine:"Comwell",script:or("comwell")},{bookingEngine:"Profitroom",script:or("profitroom")},{bookingEngine:"Prestige",script:or("prestige")},{bookingEngine:"Bookingexpert",script:or("bookingexpert")},{bookingEngine:"Booking2Hotels",script:or("booking2hotels")},{bookingEngine:"Alaric",script:or("alaric")},{bookingEngine:"Hart",script:or("hart")},{bookingEngine:"StationCasinosV1",script:or("station-casinos-v1")},{bookingEngine:"StationCasinosV2",script:or("station-casinos-v2")},{bookingEngine:"RDP",script:sr("rdp")},{bookingEngine:"Kognitiv",script:or("kognitiv")},{bookingEngine:"Innquest",script:or("innquest")},{bookingEngine:"Guild",script:or("guild")},{bookingEngine:"Seekda",script:or("seekda")},{bookingEngine:"Innroad",script:or("innroad")},{bookingEngine:"Furama",script:or("furama")},{bookingEngine:"GermainHotels",script:or("germain-hotels")},{bookingEngine:"Taj",script:or("taj")},{bookingEngine:"Reztrip",script:or("reztrip")},{bookingEngine:"Bookeasy",script:or("bookeasy")},{bookingEngine:"Protel",script:or("protel")},{bookingEngine:"Azimut",script:or("azimut")},{bookingEngine:"DeutscheHospitality",script:or("deutsche-hospitality")},{bookingEngine:"CloudBeds",script:or("cloudbeds")},{bookingEngine:"Amadeus",script:or("amadeus")},{bookingEngine:"LotteHotel",script:or("lotte")},{bookingEngine:"Hoxton",script:or("hoxton")},{bookingEngine:"Kempinski",script:or("kempinski")},{bookingEngine:"DerqueBooking",script:or("derque-booking")},{bookingEngine:"Ovolo",script:or("ovolo")},{bookingEngine:"Gleneagles",script:or("gleneagles")},{bookingEngine:"RedPlanet",script:or("redplanet")},{bookingEngine:"PursuitCollection",script:or("pursuit-collection")},{bookingEngine:"BestWesternUk",script:or("best-western-uk")},{bookingEngine:"Sbe",script:or("sbe")},{bookingEngine:"Bode",script:or("bode")},{bookingEngine:"ReserveOnline",script:or("reserve-online")},{bookingEngine:"Availpro",script:or("availpro")},{bookingEngine:"SysHotelOnline",script:or("sys-hotel-online")},{bookingEngine:"Reservit",script:or("reservit")},{bookingEngine:"Vinpearl",script:or("vinpearl")},{bookingEngine:"Omnibees",script:or("omnibees")},{bookingEngine:"Hipotels",script:or("hipotels")},{bookingEngine:"HandPickedHotels",script:or("hand-picked-hotels")},{bookingEngine:"PalaceResorts",script:or("palace-resorts")},{bookingEngine:"Zafiro",script:or("zafiro")},{bookingEngine:"Viato",script:or("viato")},{bookingEngine:"EasyBooking",script:or("easy-booking")},{bookingEngine:"Ezee",script:or("ezee")},{bookingEngine:"InnStyle",script:or("inn-style")},{bookingEngine:"FastBooking",script:or("fast-booking")},{bookingEngine:"CityExpress",script:or("city-express")},{bookingEngine:"EasyConsulting",script:or("easy-consulting")},{bookingEngine:"Travelanium",script:or("travelanium")},{bookingEngine:"EGds",script:or("e-gds")},{bookingEngine:"Booking",script:or("booking")},{bookingEngine:"Iperbooking",script:or("iperbooking")},{bookingEngine:"OKU",script:or("oku")}].reduce(((e,t)=>(e[cr(t.bookingEngine)]={name:t.bookingEngine,url:t.script,type:"script"},e)),{});function cr(e){return e.replace("-","").toLowerCase()}const lr=ar[cr("Default")];const dr=Ut("messaging");class ur{constructor(e){this.messageHandler=e,this.promises=new Map,e&&e.addListener((e=>{if(Jn(e)){const{correlationId:t}=e,n=this.promises.get(t);n&&(dr.debug("Sender matched response",e),n.resolve(e),this.promises.delete(t))}}))}handle(e){return r(this,void 0,void 0,(function*(){return dr.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise(((t,n)=>{this.promises.set(e.correlationId,{resolve:t,reject:n})}))}))}}class hr{constructor(e,t,n=Ut("messaging")){this.listen=e,this.router=t,this.logger=n,this.rules=[],e.addListener(this.handler.bind(this)),this.addRule(Kn,(e=>e),(e=>e)),this.addRule(gr,pr,fr)}registerAlias(e,t){if(!this.router.hasHandlerFor(t))throw new Error(`Illegal alias: Method "${t}" is not registered with router`);return this.addRule((n=e,e=>e.type===n),function(e){return t=>({type:"triptease.onboard.request",requestType:String(e),payload:[t],correlationId:t.correlationId||"fire-and-forget"})}(t),fr);var n}handler(e,t){return r(this,void 0,void 0,(function*(){if(Jn(e))return;this.logger.debug("listenOn received request",e);const n=this.rules.find((t=>t.predicate(e)));if(!n)return;const r=n.requestConverter(e),i=yield this.router.handle(r);!function(e){return vt.get((()=>"NotFound"===e.payload.name),!1)}(i)?e.correlationId&&e.correlationId===i.correlationId&&(this.logger.debug("listenOn sending response to sender",i),t.send(n.responseConverter(i))):this.logger.debug(`Handler not found for request "${r.requestType}", potentially for another listener`)}))}addRule(e,t,n){return this.rules.push({predicate:e,requestConverter:t,responseConverter:n}),this}}function gr(e){return!Kn(e)&&!!e.correlationId}function pr(e){const{value:t,correlationId:n}=e,{method:r}=Zt(e.type);return{type:"triptease.onboard.request",requestType:r,payload:[t],correlationId:n}}function fr(e){return{type:"triptease.onboard.response",correlationId:e.correlationId,value:e.payload}}function yr(e){const t=Dt(e,"triptease-applications")||"auto";return vt.get((()=>{const[t]=class{static find(e){const t=["bootstrap.js","/paperboy/","/identity-service/confirm"].map((e=>`script[src*="${e}"][src*="triptease.io"]`));t.push('script[src*="triptease.net"]');const n=t.join(", ");return vt.Arrays.from(e.querySelectorAll(n)).map((e=>new l(e.src)))}}.find(e.document),{applications:n}=qt(t.query);return n}),t).toLowerCase()}var mr,vr;(vr=mr||(mr={})).Config="triptease.config",vr.Error="triptease.onboard.error",vr.Message="triptease.onboard.message",vr.PageDisplayedSearch="triptease.integration.page_displayed_search",vr.PageDisplayedRoomsAndRates="triptease.integration.page_displayed_rooms-and-rates",vr.PageDisplayedConfirmation="triptease.integration.page_displayed_confirmation",vr.PageDisplayedUnknown="triptease.integration.page_displayed_unknown",vr.PageDisplayedGroup="triptease.integration.page_displayed_group",vr.PageDisplayedPartial="triptease.integration.page_displayed_partial",vr.PageErroredRoomsAndRates="triptease.integration.page_errored_rooms-and-rates",vr.PageErroredConfirmation="triptease.integration.page_errored_confirmation",vr.IntegrationData="triptease.integration.integration_data",vr.PartialConfirmationPageData="triptease.integration.partial_confirmation_data",vr.InvalidConfirmationData="triptease.integration.invalid_confirmation_data",vr.InvalidPage="triptease.integration.invalid_page",vr.GenericScript="triptease.integration.generic_script",vr.DataCapture="triptease.integration.data_capture",vr.GenericAnalysisConfirmation="triptease.integration.generic_analysis_confirmation",vr.EntityUpdate="triptease.entity.update",vr.StatusChanged="triptease.onboard.status-changed";class br{constructor(e,t,n){this.window=e,this.messageBatcher=t,this.messageBuilder=n}get isEnabled(){const e=yr(this.window);return"auto"===e||"analytics"===e}trackConfig(e){return r(this,void 0,void 0,(function*(){this.isEnabled&&(vt.get((()=>e.payload.type===nn.Payment))||(yield this.messageBatcher.send(vt.Objects.removeEmpty(e))))}))}trackEvent(e){return r(this,void 0,void 0,(function*(){this.isEnabled&&(yield this.messageBatcher.send(e))}))}trackError(e){return r(this,void 0,void 0,(function*(){this.isEnabled&&(yield this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:mr.Error,errorType:Yt(e)?"exception":"console",payload:e})))}))}trackMessage(e){return r(this,void 0,void 0,(function*(){this.isEnabled&&(yield this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:mr.Message,payload:e})))}))}}class wr{constructor(e,t,n=Ut("integration-executor"),r=mn.create(e)){this.window=e,this.kernel=t,this.logger=n,this.starter=r}loadApplications(e){return r(this,void 0,void 0,(function*(){const t=yr(this.window);if("none"===t)return this.logger.log('applications set to "none", skipping loading'),{};const{integrationId:n,clientKey:r,apiKey:i}=e,{applications:o}=yield this.kernel.applicationConfig({integrationId:n,clientKey:r,apiKey:i}),s="auto"===t?o:o.filter((e=>e.name.toLowerCase()===t)),a=s.filter(dn);return this.logger.log("load applications",a),yield Promise.all(a.map((e=>vt.get((()=>this.starter.start(e)))))),s.reduce(((e,t)=>(e[t.name]=!0,e)),{})}))}static create(e,t){var n;const r=xt(e).triptease.onboard;return r.applicationLoader=null!==(n=r.applicationLoader)&&void 0!==n?n:new wr(e,t)}}const kr=Ut("events");class Er{constructor(e,t){this.timers=e,this.handle=t,this.finders=new Set,this.keepers=new WeakSet,this.handleEvent=e=>r(this,void 0,void 0,(function*(){try{if(kr.debug("Checking for new created items"),0===this.finders.size)return;const t=Array.from(this.finders).flatMap((e=>e()));t.reduce(((e,t)=>this.keepers.has(t)?e:(this.keepers.add(t),!0)),!1)&&(kr.log("Newly created element detected - firing event"),yield this.handle(e))}catch(e){kr.error("CreatedEvents.handleEvent threw while polling",e)}}))}start(){return r(this,void 0,void 0,(function*(){kr.log("Start polling for created items"),this.id=this.timers.setInterval(this.handleEvent,1e3)}))}stop(){return r(this,void 0,void 0,(function*(){kr.log("Stop polling for created items"),this.id&&(this.timers.clearInterval(this.id),this.id=void 0)}))}watch(e){e().forEach((e=>this.keepers.add(e))),this.finders.add(e)}}function Or(e){return new Promise((t=>{this.setTimeout((()=>{t()}),e)}))}class xr{constructor(e=new Dn){this.clock=e,this.delay=Or.bind(this),this.delay=Or}task(e){return r(this,void 0,void 0,(function*(){return yield this.delay(0),e()}))}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}setInterval(e,t){return setInterval(e,t)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,t){const n=t?t.timeout:1;let r=this.clock.now().getTime()+n;const i=this;return this.setTimeout((()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(i.clock.now().getTime()-r))})}),n)}cancelIdleCallback(e){this.clearTimeout(e)}}new xr;const Sr=Ut("events");class Ir{constructor(e,t){this.window=e,this.delegate=t,this.first=!0,this.fire=e=>r(this,void 0,void 0,(function*(){!this.window.document.hidden||this.first?(yield this.delegate.fire(),this.first=!1):Sr.log("Document hidden - skipping",e)}))}listen(e){return r(this,void 0,void 0,(function*(){yield this.delegate.listen(e)}))}removeListener(e){this.delegate.removeListener(e)}}const Ar=Ut("events");class Tr{constructor(e,t){this.delegate=e,this.running=t,this.fire=e=>r(this,void 0,void 0,(function*(){this.running.value?Ar.log("Already running - skipping",e):(this.running.value=!0,yield this.delegate.fire(),this.running.value=!1)}))}listen(e){return r(this,void 0,void 0,(function*(){if(yield this.delegate.listen(e),this.running.value){Ar.log("Already running - firing immediately");try{yield e()}catch(e){Ar.log(e)}}}))}removeListener(e){this.delegate.removeListener(e)}}const Cr=Ut("events");class jr{constructor(){this.handlers=[],this.fire=e=>r(this,void 0,void 0,(function*(){Cr.log(`Firing handlers(${this.handlers.length})`,e),yield Promise.all(this.handlers.map((e=>r(this,void 0,void 0,(function*(){try{yield e()}catch(e){Cr.log("Error while firing handler",e)}})))))}))}listen(e){return r(this,void 0,void 0,(function*(){this.handlers.push(e)}))}removeListener(e){this.handlers=this.handlers.filter((t=>t!==e))}}const Pr=Ut("events");class Lr{constructor(e,t){this.timers=e,this.delegate=t,this.timeoutMs=1e3,this.timerId=0,this.fire=e=>r(this,void 0,void 0,(function*(){Pr.log(`Event observed, waiting for ${this.timeoutMs} ms quiet`,e),this.timers.clearInterval(this.timerId),this.timerId=this.timers.setTimeout((()=>r(this,void 0,void 0,(function*(){Pr.log("Event quiet period ended, firing event",e),yield this.delegate(e)}))),this.timeoutMs)}))}}const qr=Ut("events");class Mr{constructor(e,t,n=.2,i=new xr){this.handle=e,this.running=t,this.idleThreshold=n,this.timers=i,this.lastState=!1,this.busy=!1,this.average=new Rr,this.idleHandler=e=>{const t=e.timeRemaining();this.running.value?this.busy=!1:0===t?this.busy=!0:(this.average=this.average.calculate(t),this.busy=this.average.percentage<-this.idleThreshold),this.busy?this.idleId=void 0:this.idleId=this.timers.requestIdleCallback(this.idleHandler,0===t?void 0:{timeout:t})},this.intervalHandler=()=>r(this,void 0,void 0,(function*(){this.stateHasChanged()&&this.isIdle()&&(qr.log("Browser idle"),yield this.handle("Idle")),this.average=new Rr,this.lastState=this.busy,this.idleId||(this.idleId=this.timers.requestIdleCallback(this.idleHandler))}))}start(){return r(this,void 0,void 0,(function*(){this.intervalId=this.timers.setInterval(this.intervalHandler,1e3),this.idleId=this.timers.requestIdleCallback(this.idleHandler)}))}stop(){return r(this,void 0,void 0,(function*(){this.intervalId&&this.timers.clearInterval(this.intervalId),this.idleId&&this.timers.cancelIdleCallback(this.idleId)}))}isIdle(){return!this.busy}stateHasChanged(){return this.lastState!==this.busy}}class Rr{constructor(e=0,t=0,n=0,r=0){this.value=e,this.count=t,this.difference=n,this.percentage=r}calculate(e){const t=this.count+1,n=e-this.value,r=n/this.value,i=this.value+n/t;return new Rr(i,t,n,r)}}class Br{constructor(e,t){this.window=e,this.handle=t}start(){return r(this,void 0,void 0,(function*(){this.window.addEventListener("visibilitychange",this.handle),this.window.addEventListener("popstate",this.handle),this.window.addEventListener("hashchange",this.handle),this.window.addEventListener("pageshow",this.handle),this.window.addEventListener("pagehide",this.handle),"complete"!==this.window.document.readyState?this.window.document.addEventListener("DOMContentLoaded",this.handle):yield this.handle("Document already loaded")}))}stop(){return r(this,void 0,void 0,(function*(){this.window.removeEventListener("visibilitychange",this.handle),this.window.removeEventListener("popstate",this.handle),this.window.removeEventListener("hashchange",this.handle),this.window.removeEventListener("pageshow",this.handle),this.window.removeEventListener("pagehide",this.handle),this.window.document.removeEventListener("DOMContentLoaded",this.handle)}))}}class Hr{constructor(){this.value=!1}}class _r{constructor(e,t=new xr){this.window=e;const n=new Hr;this.sink=new Ir(e,new Tr(new jr,n)),this.fire=new Lr(t,this.sink.fire).fire,this.mutation=new Dr(this.fire),this.created=new Er(t,this.fire),this.sources=[new Mr(this.fire,n),this.mutation,this.created,new Br(e,this.fire)]}watch(e){this.created.watch(e)}listen(e){return r(this,void 0,void 0,(function*(){yield this.sink.listen(e)}))}start(){return r(this,void 0,void 0,(function*(){yield Promise.all(this.sources.map((e=>e.start())))}))}stop(){return r(this,void 0,void 0,(function*(){this.sources.forEach((e=>e.stop()))}))}removeListener(e){this.sink.removeListener(e)}}function zr(e){const t=xt(e).triptease;return t.events=t.events||new _r(e)}const Nr={characterData:!0,attributes:!0,childList:!0};class Dr{constructor(e){this.handle=e,this.observer=new MutationObserver(this.handle)}start(){return r(this,void 0,void 0,(function*(){}))}stop(){return r(this,void 0,void 0,(function*(){this.observer.disconnect()}))}static observe(e,t=Nr){if(!("MutationObserver"in vt.globalThis))return e;const n=zr(vt.globalThis).mutation;return e instanceof HTMLInputElement||e instanceof HTMLSelectElement?e.addEventListener("change",n.handle):n.observer.observe(e,t),e}}Ut("messaging");const Fr=Ut("identity"),Wr="triptease-anonymous-id";class $r{constructor(e){this.storage=e}getAnonymousIds(){return r(this,void 0,void 0,(function*(){const e=this.storage.get(Wr);return e?[e]:[]}))}setAnonymousId(e){return r(this,void 0,void 0,(function*(){const t=this.storage.get(Wr);(t&&e<t||!t)&&this.storage.set(Wr,e)}))}}class Ur{constructor(e){this.storage=e,this.key="tt-domain-user-id",this.pattern=/[0-9A-Z]{26}/}getAnonymousIds(){return r(this,void 0,void 0,(function*(){const e=this.storage[this.key]||"";return this.pattern.test(e)?[e]:[]}))}setAnonymousId(e){return r(this,void 0,void 0,(function*(){}))}}class Vr{constructor(e){this.providers=e}static create(...e){return new Vr(e)}getAnonymousIds(){return r(this,void 0,void 0,(function*(){return vt.Arrays.unique(vt.Arrays.flatten(yield Promise.all(this.providers.map((e=>vt.get((()=>e.getAnonymousIds()),[])))))).sort()}))}setAnonymousId(e){return r(this,void 0,void 0,(function*(){yield Promise.all(this.providers.map((t=>vt.get((()=>t.setAnonymousId(e))))))}))}}class Gr{constructor(e,t=new En){this.delegate=e,this.generator=t}getAnonymousIds(){return r(this,void 0,void 0,(function*(){const e=(yield this.delegate.getAnonymousIds())[0]||this.generator.generate();return yield this.delegate.setAnonymousId(e),[e]}))}setAnonymousId(e){return this.delegate.setAnonymousId(e)}}class Kr{constructor(e,t,n=new xr){this.delay=e,this.delegate=t,this.timers=n,this.raceCounter=0}getAnonymousIds(){const e=this.raceCounter++;return Promise.race([(()=>r(this,void 0,void 0,(function*(){Fr.debug("TimeoutIdentityProvider delegate.getAnonymousIds called",e);const t=yield this.delegate.getAnonymousIds();return Fr.debug("TimeoutIdentityProvider delegate.getAnonymousIds returned",t,e),t})))(),this.wait(e)])}setAnonymousId(e){return r(this,void 0,void 0,(function*(){Fr.debug("TimeoutIdentityProvider delegate.setAnonymousId called",e),this.delegate.setAnonymousId(e)}))}wait(e){return r(this,void 0,void 0,(function*(){return yield this.timers.delay(this.delay),Fr.debug(`TimeoutIdentityProvider waited for ${this.delay} ms`,e),[]}))}}class Jr{constructor(e){this.storage=e}get(e){const t=this.storage.getItem(e);if(t)return Pt.parseWithDates(t)}set(e,t){return this.storage.setItem(e,JSON.stringify(t)),this}clear(){this.storage.clear()}}class Zr{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t)}clear(){this.data.clear()}}class Xr{constructor(e,t=2e3,n=new xr){this.handler=e,this.timeout=t,this.timers=n}handle(e){return r(this,void 0,void 0,(function*(){const t=yield Promise.race([this.handler.handle(e),this.timers.delay(this.timeout)]);return t||{type:Gn,payload:new Error(`Request ${e.requestType} timed out after ${this.timeout}`),correlationId:e.correlationId}}))}}class Yr{constructor(e,t=new Nn,n=zr(e),i=new Vn(e),o=new Wn(e,t),s=new br(e,o,i),a=new Vt("bootstrap",s),c=mn.create(e),l=new vn(e,a),d=new Pn(e,t),u=Hn.create(e)){this.window=e,this.clock=t,this.events=n,this.messageBuilder=i,this.messageBatcher=o,this.trackingApi=s,this.logger=a,this.starter=c,this.waiter=l,this.identityHelper=d,this.stackScripts=u,this.integrate=()=>r(this,void 0,void 0,(function*(){try{this.logger.log("Starting integrate()");const e=rr(this.window);xt(this.window).onboard.bookingEngine=e.bookingEngine;const t=function({bookingEngine:e,originalUrl:t}){return ar[cr(e)]||(t?function(e,t){return{name:e,url:t.replace("static.triptease.io","integration.triptease.io"),type:"script"}}(e,t):lr)}(e);yield this.starter.start(t)}catch(e){this.logger.error("Bootstrap.integrate: unhandled exception",e)}})),xt(this.window).onboard.bootstrap=this}start(){return r(this,void 0,void 0,(function*(){try{this.logger.debug("Bootstrap starting"),It.exposeApi(),this.stackScripts.capture();const[e,t]=yield Promise.all([this.identityHelper.getIdentity(),this.kernelFrame()]);this.identity=e;const n=t.contentWindow;if(!n)return void this.logger.log("Kernel frame did not generate a content window, aborting");const i=new Gt(this.window,n,[]),o=new Xr(new ur(i));this.kernel=new Bn(o),this.kernelHost=Rn(o),new hr(i,(new Qn).register(["processEvent"],new tr(this)).register(["getAnonymousIds","setAnonymousId"],new tr(new Vr(this.identityProviders))).register(["trackConfig","trackEvent","trackError","trackMessage"],new tr(this.trackingApi))).registerAlias("triptease.event","processEvent").registerAlias("triptease.config","trackConfig"),wr.create(this.window,this.kernel),vt.getAsync((()=>r(this,void 0,void 0,(function*(){const[e]=yield new Gr(new Vr([...this.identityProviders,new Kr(100,this.kernelHost)])).getAnonymousIds();this.identity.anonymousId=e,this.logger.log("anonymousId",e)})))),yield this.events.listen(this.integrate),yield this.events.start()}catch(e){this.logger.error("Bootstrap.start: unhandled exception",e)}}))}get identityProviders(){const e=[new $r(new Zr),vt.get((()=>new $r(new Jr(this.window.localStorage)))),new Ur(vt.get((()=>this.window.localStorage),{}))];return this.window.opener&&e.push(new Kr(1e3,Rn(new ur(new Gt(this.window,this.window.opener,[]))))),e}reload(){return r(this,void 0,void 0,(function*(){this.logger.debug("Bootstrap reloading"),this.stackScripts.capture(),yield this.integrate()}))}kernelFrame(){return r(this,void 0,void 0,(function*(){const e=class{static application(e){const t=function(e=vt.globalThis){const t=Dt(e,Nt);return vt.Strings.isEmpty(t)?"":Mt({[Nt]:t})}();return{name:un,url:`https://onboard.triptease.io/kernel/${hn.get()}/kernel-host.html?originHost=${e}${t?"&"+t:""}`,type:"iframe",startMessage:"triptease.onboard.kernel-host-started"}}}.application(this.window.location.hostname);return yield this.starter.start(e)}))}processEvent(e){return r(this,void 0,void 0,(function*(){const t=yield this.kernelHost.getPageState(),n=yield this.messageBuilder.buildMessage(Lt.merge(e,t));yield this.trackingApi.trackEvent(n)}))}}t([Z.lazy,n("design:type",Array),n("design:paramtypes",[])],Yr.prototype,"identityProviders",null);const Qr=Ut("bootstrap"),ei=vt.get((()=>window.triptease.onboard.bootstrap));r(void 0,void 0,void 0,(function*(){const{"triptease-bootstrap-version":e=""}=qt(window.location.search);["none","noop"].includes(e.toLowerCase())||(ei?(Qr.log("Bootstrap reloading"),yield ei.reload()):(Qr.log("Creating new bootstrap"),yield new Yr(window).start()))}))}();